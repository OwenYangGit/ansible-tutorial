---
  - name: Play dev
    hosts: dev
    gather_facts: yes
    tasks:
      - name: Copy compose to hosts
        copy:
          src: ./stack/docker-compose.yml
          dest: ~/
      - name: Get stack info
        # 用 docker_stack module 要在 remote host 上安裝 pip3 install jsondiff && pip3 install pyyaml
        community.docker.docker_stack:
          name: my-nginx
          state: present
          resolve_image: always
          with_registry_auth:
          compose:
            - ~/docker-compose.yml
      - name: Remove stack
        community.docker.docker_stack:
          name: my-nginx
          state: absent